<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Visualización del producto</title>
  <link rel="stylesheet" href="estilos.css">
</head>
<body>
  <div class="contenedor-producto">
    <div class="imagen" id="imagen-prod"></div>
    <div class="info" id="detalle-producto"></div>
  </div>
  <div class="botones-fijos">
    <button onclick="location.href='index.html'">Inicio</button>
    <button id="btn-catalogo">Regresar al catálogo</button>
    <button id="btn-agregar">Agregar al carrito</button>
    <button onclick="location.href='carrito.html'">Carrito</button>
  </div>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const params = new URLSearchParams(location.search);
      const id = params.get("id");
      if (!id) {
        document.getElementById("detalle-producto").innerText = "Producto no encontrado.";
        return;
      }
      fetch("https://admin-backend-ts85.onrender.com/productos")
        .then(res => res.json())
        .then(list => {
          const prod = list.find(p => String(p.id) === id || String(p._id) === id);
          if (!prod) {
            document.getElementById("detalle-producto").innerText = "Producto no encontrado.";
            return;
          }
          document.getElementById("imagen-prod").innerHTML =
            `<img src="${prod.fotos[0]}" alt="${prod.nombre}">`;
          const hasDesc = prod.descuento > 0;
          const precioFinal = hasDesc
            ? (prod.precio * (1 - prod.descuento / 100)).toFixed(2)
            : prod.precio.toFixed(2);
          const tallas = prod.talla ? prod.talla.split(",").map(t=>t.trim()) : [];
          let html = `<h2>${prod.nombre}</h2>
            <p><strong>Precio:</strong> $${precioFinal}</p>`;
          if (hasDesc) html = `<p><strong>Antes:</strong> $${prod.precio.toFixed(2)}</p>` + html;
          if (prod.marca)      html += `<p><strong>Marca:</strong> ${prod.marca}</p>`;
          if (prod.producto)   html += `<p><strong>Tipo:</strong> ${prod.producto}</p>`;
          if (prod.categoria)  html += `<p><strong>Categoría:</strong> ${prod.categoria}</p>`;
          if (prod.descripcion) html += `<p><strong>Descripción:</strong> ${prod.descripcion}</p>`;
          if (tallas.length) {
            html += `<p><strong>Tallas:</strong>
              <select id="selector-talla">
                <option value="">Seleccione</option>
                ${tallas.map(t=>`<option>${t}</option>`).join("")}
              </select>
            </p>`;
          }
          document.getElementById("detalle-producto").innerHTML = html;

          document.getElementById("btn-agregar").onclick = () => {
            const sel = document.getElementById("selector-talla");
            if (sel && !sel.value) { alert("Selecciona una talla"); return; }
            const carrito = JSON.parse(localStorage.getItem("carrito")||"[]");
            const item = { ...prod, tallaSeleccionada: sel?.value };
            carrito.push(item);
            localStorage.setItem("carrito", JSON.stringify(carrito));
            alert("Agregado al carrito");
          };
          document.getElementById("btn-catalogo").onclick = () => {
            const cat = prod.categoria ? prod.categoria.toLowerCase().replace(/\s+/g,"") : "index";
            location.href = `${cat}.html`;
          };
        })
        .catch(() => {
          document.getElementById("detalle-producto").innerText = "Error cargando el producto.";
        });
    });
  </script>
</body>
</html>
